{% extends 'base.html' %}

{% block content %}
<div class="container">
    <h1 class="title">Perfil de Usuario</h1>
    
    <div class="box">
        <div class="media">
            <div class="media-left">
                <figure class="image is-128x128">
                    <div class="has-background-info has-text-white is-flex is-align-items-center is-justify-content-center" 
                         style="width: 128px; height: 128px; border-radius: 50%; font-size: 48px;">
                        <i class="fas fa-user"></i>
                    </div>
                </figure>
            </div>
            <div class="media-content">
                <p class="title is-3">{{ user.first_name }} {{ user.last_name }}</p>
                <p class="subtitle is-5">@{{ user.username }}</p>
                <span class="tag is-{{ 'danger' if user.role == 'admin' else 'info' }} is-medium">
                    {{ 'Administrador' if user.role == 'admin' else 'Usuario' }}
                </span>
            </div>
        </div>
    </div>

    <div class="columns">
        <div class="column">
            <div class="box">
                <h2 class="title is-4">
                    <span class="icon"><i class="fas fa-chart-bar"></i></span>
                    <span>Estadísticas</span>
                </h2>
                <div class="content">
                    <p><strong>Problemas resueltos:</strong> {{ user.problems|length }}</p>
                    <p><strong>Rol:</strong> {{ user.role|capitalize }}</p>
                    <p><strong>Miembro desde:</strong> Usuario registrado</p>
                </div>
            </div>
        </div>
        <div class="column">
            <div class="box">
                <h2 class="title is-4">
                    <span class="icon"><i class="fas fa-link"></i></span>
                    <span>Accesos Rápidos</span>
                </h2>
                <div class="buttons">
                    <a href="{{ url_for('method.index') }}" class="button is-info is-fullwidth">
                        <span class="icon"><i class="fas fa-calculator"></i></span>
                        <span>Métodos Numéricos</span>
                    </a>
                    <a href="{{ url_for('method.historial') }}" class="button is-link is-fullwidth">
                        <span class="icon"><i class="fas fa-history"></i></span>
                        <span>Mi Historial</span>
                    </a>
                    {% if user.has_role('admin') %}
                    <a href="{{ url_for('user.list_users') }}" class="button is-warning is-fullwidth">
                        <span class="icon"><i class="fas fa-users"></i></span>
                        <span>Gestionar Usuarios</span>
                    </a>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    {% if user.problems %}
    <div class="box">
        <h2 class="title is-4">
            <span class="icon"><i class="fas fa-clock"></i></span>
            <span>Actividad Reciente</span>
        </h2>
        <div class="table-container">
            <table class="table is-fullwidth is-striped">
                <thead>
                    <tr>
                        <th>Método</th>
                        <th>Título</th>
                        <th>Fecha</th>
                        <th>Acción</th>
                    </tr>
                </thead>
                <tbody>
                    {% for problem in user.problems[:5] %}
                    <tr>
                        <td>
                            {% if problem.method_type == 'CG' %}
                            <span class="tag is-info">CG</span>
                            {% elif problem.method_type == 'SOR' %}
                            <span class="tag is-success">SOR</span>
                            {% elif problem.method_type == 'ROOTS' %}
                            <span class="tag is-warning">Raíces</span>
                            {% elif problem.method_type == 'INTERPOLATION' %}
                            <span class="tag is-danger">Interpolación</span>
                            {% endif %}
                        </td>
                        <td>{{ problem.title or 'Sin título' }}</td>
                        <td>{{ problem.created_at.strftime('%d/%m/%Y') }}</td>
                        <td>
                            <a href="{{ url_for('method.ver_problema', id=problem.id) }}" class="button is-small is-info">Ver</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <a href="{{ url_for('method.historial') }}" class="button is-link">Ver Historial Completo</a>
    </div>
    {% else %}
    <div class="notification is-info">
        <p>Aún no has resuelto ningún problema. ¡Comienza ahora!</p>
        <a href="{{ url_for('method.index') }}" class="button is-info mt-3">Ir a Métodos Numéricos</a>
    </div>
    {% endif %}
</div>
{% endblock %}
